<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardi√£o da √Ågua - Jogo Educacional</title>
    <meta name="description" content="Jogo educacional de simula√ß√£o e gerenciamento de recursos h√≠dricos">
    <meta name="keywords" content="√°gua, educa√ß√£o, sustentabilidade, jogo, simula√ß√£o">
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/ui.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/tutorial.css">

    <!-- Babylon.js CDN -->
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    
    <!-- Preload de recursos cr√≠ticos -->
    <link rel="preload" href="Sprites/SUNNYSIDE_WORLD_BUILDINGS_V0.01.png" as="image">
    <link rel="preload" href="Sounds/BGM/" as="audio">
</head>
<body>
    <!-- Tela de Loading -->
    <div id="loading-screen" class="screen active">
        <div class="loading-container">
            <div class="logo">
                <h1>üíß Guardi√£o da √Ågua</h1>
                <p>Carregando recursos...</p>
            </div>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-tips">
                <p id="loading-tip">Dica: A √°gua √© um recurso finito e precioso!</p>
            </div>
        </div>
    </div>

    <!-- Menu Principal -->
    <div id="main-menu" class="screen">
        <div class="menu-container">
            <div class="menu-header">
                <h1>üíß Guardi√£o da √Ågua</h1>
                <p class="subtitle">Gerencie os recursos h√≠dricos da sua cidade</p>
            </div>
            
            <div class="menu-buttons">
                <button id="btn-new-game" class="menu-btn primary">
                    <span class="btn-icon">üéÆ</span>
                    Novo Jogo
                </button>
                
                <button id="btn-about" class="menu-btn secondary">
                    <span class="btn-icon">‚ÑπÔ∏è</span>
                    Sobre
                </button>
            </div>
        </div>
    </div>

    <!-- Tela do Jogo -->
    <div id="game-screen" class="screen">
        <!-- Canvas 3D do Babylon.js -->
        <canvas id="game-canvas"></canvas>
        
        <!-- HUD - Interface do Jogo -->
        <div id="game-hud" class="hud">
            <!-- Painel Superior - Recursos -->
            <div class="hud-top">
                <!-- Compact Resource Indicators (Mobile) -->
                <div class="compact-resources">
                    <div class="compact-resource-item" id="compact-budget">
                        <span class="compact-icon">üí∞</span>
                        <span class="compact-value">50K</span>
                    </div>
                    <div class="compact-resource-item" id="compact-water">
                        <span class="compact-icon">üíß</span>
                        <span class="compact-value">1000L</span>
                    </div>
                    <div class="compact-resource-item" id="compact-energy">
                        <span class="compact-icon">‚ö°</span>
                        <span class="compact-value">0MW</span>
                    </div>
                    <div class="compact-resource-item" id="compact-population">
                        <span class="compact-icon">üë•</span>
                        <span class="compact-value">500</span>
                    </div>
                </div>

                <div class="resource-panel">
                    <div class="resource-item">
                        <span class="resource-icon">üíß</span>
                        <span class="resource-value" id="water-amount">1000L</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">üè≠</span>
                        <span class="resource-value" id="pollution-level">15%</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">üë•</span>
                        <span class="resource-value" id="population-count">500</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">üòä</span>
                        <span class="resource-value" id="satisfaction-level">85%</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-icon">üí∞</span>
                        <span class="resource-value" id="budget-amount">R$ 50.000</span>
                    </div>

                    <div class="resource-item">
                        <span class="resource-icon">‚ö°</span>
                        <span class="resource-value" id="electricity-amount">0 MW</span>
                    </div>

                    <div class="resource-item">
                        <span class="resource-icon">üïê</span>
                        <span class="resource-value" id="game-clock">00/00/0000 00:00</span>
                    </div>
                </div>
                
                <!-- Bot√µes de Controle -->
                <div class="control-buttons">
                    <button id="btn-pause" class="control-btn">‚è∏Ô∏è</button>
                    <button id="btn-speed-1x" class="control-btn active">1x</button>
                    <button id="btn-speed-2x" class="control-btn">2x</button>
                    <button id="btn-speed-3x" class="control-btn">3x</button>
                    <button id="btn-loans" class="control-btn loans-btn" title="Empr√©stimos" onclick="window.gameManager.uiManager.showLoanInterface()">üè¶</button>
                    <button id="btn-missions" class="control-btn missions-btn" title="Miss√µes">üéØ</button>
                    <button id="btn-help" class="control-btn help-btn" title="Controles">‚ùì</button>
                </div>
            </div>

            <!-- Painel Lateral - Constru√ß√£o -->
            <div class="hud-left">
                <div class="building-panel" id="building-panel">
                    <h3>Constru√ß√µes</h3>
                    <div class="building-categories">
                        <button class="category-btn active" data-category="water">üíß √Ågua</button>
                        <button class="category-btn" data-category="treatment">üè≠ Tratamento</button>
                        <button class="category-btn" data-category="storage">üèóÔ∏è Armazenamento</button>
                        <button class="category-btn" data-category="public">üèõÔ∏è P√∫blicos</button>
                        <button class="category-btn" data-category="power">‚ö° Energia</button>
                        <button class="category-btn" data-category="infrastructure">üõ£Ô∏è Infraestrutura</button>
                        <button class="category-btn" data-category="zoning">üèòÔ∏è Zoneamento</button>
                        <button class="category-btn" data-category="commercial">üè¨ Comercial</button>
                        <button class="category-btn" data-category="tourism">üé° Turismo</button>
                        <button class="category-btn" data-category="industrial">üè≠ Industrial</button>
                    </div>
                    <div class="building-items" id="building-items">
                        <!-- Itens de constru√ß√£o ser√£o inseridos dinamicamente -->
                    </div>
                </div>
            </div>

            <!-- Painel Inferior - Informa√ß√µes e Miss√µes -->
            <div class="hud-bottom">
                <div class="info-panel">
                    <div class="mission-info">
                        <div class="mission-header">
                            <h4>Miss√£o Atual</h4>
                            <div class="mission-urgency" id="mission-urgency"></div>
                        </div>
                        <div class="mission-objective-display" id="mission-objective-display" onclick="window.gameManager.questSystem.focusOnCurrentObjective()">
                            <div class="objective-icon" id="objective-icon">üéØ</div>
                            <div class="objective-content">
                                <div class="objective-title" id="current-mission">Construa sua primeira esta√ß√£o de tratamento de √°gua</div>
                                <div class="objective-action" id="objective-action">Clique para ver detalhes</div>
                            </div>
                            <div class="objective-status" id="objective-status">
                                <div class="progress-text">1/4</div>
                            </div>
                        </div>
                        <div class="mission-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="mission-progress" style="width: 25%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="notifications" id="notifications">
                        <!-- Notifica√ß√µes aparecer√£o aqui -->
                    </div>
                </div>
            </div>

            <!-- Painel Direito - Detalhes -->
            <div class="hud-right">
                <div class="details-panel" id="details-panel">
                    <h3>Informa√ß√µes</h3>
                    <div class="details-content" id="details-content">
                        <p>Selecione um item para ver detalhes</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overlay de Pausa -->
        <div id="pause-overlay" class="overlay hidden">
            <div class="overlay-content">
                <h2>Jogo Pausado</h2>
                <div class="overlay-buttons">
                    <button id="btn-resume" class="overlay-btn primary">Continuar</button>
                    <button id="btn-save-game" class="overlay-btn secondary">Salvar Jogo</button>
                    <button id="btn-main-menu" class="overlay-btn secondary">Menu Principal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Tutorial -->
    <div id="tutorial-screen" class="screen">
        <div class="tutorial-container">
            <div class="tutorial-header">
                <h2>Tutorial - Guardi√£o da √Ågua</h2>
                <button id="btn-close-tutorial" class="close-btn">‚úï</button>
            </div>
            <div class="tutorial-content" id="tutorial-content">
                <!-- Conte√∫do do tutorial ser√° inserido dinamicamente -->
            </div>
            <div class="tutorial-navigation">
                <button id="btn-tutorial-prev" class="tutorial-btn" disabled>‚Üê Anterior</button>
                <span class="tutorial-page" id="tutorial-page">1 / 5</span>
                <button id="btn-tutorial-next" class="tutorial-btn">Pr√≥ximo ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- Tela de Configura√ß√µes -->
    <div id="settings-screen" class="screen">
        <div class="settings-container">
            <div class="settings-header">
                <h2>‚öôÔ∏è Configura√ß√µes</h2>
                <button id="btn-close-settings" class="close-btn">‚úï</button>
            </div>
            <div class="settings-content">
                <!-- Se√ß√£o de √Åudio -->
                <div class="settings-section">
                    <h3>üîä √Åudio</h3>
                    <div class="setting-item">
                        <label for="master-volume">Volume Geral</label>
                        <div class="volume-control">
                            <input type="range" id="master-volume" min="0" max="100" value="80">
                            <span id="master-volume-value">80%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="music-volume">Volume da M√∫sica</label>
                        <div class="volume-control">
                            <input type="range" id="music-volume" min="0" max="100" value="70">
                            <span id="music-volume-value">70%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="sfx-volume">Volume dos Efeitos</label>
                        <div class="volume-control">
                            <input type="range" id="sfx-volume" min="0" max="100" value="90">
                            <span id="sfx-volume-value">90%</span>
                        </div>
                    </div>
                </div>

                <!-- Se√ß√£o de Gr√°ficos -->
                <div class="settings-section">
                    <h3>üé® Gr√°ficos</h3>
                    <div class="setting-item">
                        <label for="graphics-quality">Qualidade Gr√°fica</label>
                        <select id="graphics-quality">
                            <option value="low">Baixa</option>
                            <option value="medium" selected>M√©dia</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="antialiasing">Anti-aliasing</label>
                        <input type="checkbox" id="antialiasing" checked>
                    </div>
                    <div class="setting-item">
                        <label for="shadows">Sombras</label>
                        <input type="checkbox" id="shadows" checked>
                    </div>
                </div>

                <!-- Se√ß√£o de Gameplay -->
                <div class="settings-section">
                    <h3>üéÆ Gameplay</h3>
                    <div class="setting-item">
                        <label for="difficulty">Dificuldade</label>
                        <select id="difficulty">
                            <option value="easy">F√°cil</option>
                            <option value="normal" selected>Normal</option>
                            <option value="hard">Dif√≠cil</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="auto-save">Salvamento Autom√°tico</label>
                        <input type="checkbox" id="auto-save" checked>
                    </div>
                    <div class="setting-item">
                        <label for="tutorial-hints">Dicas do Tutorial</label>
                        <input type="checkbox" id="tutorial-hints" checked>
                    </div>
                </div>

                <!-- Se√ß√£o de Controles -->
                <div class="settings-section">
                    <h3>üéÆ Controles</h3>
                    <div class="setting-item">
                        <label for="camera-sensitivity">Sensibilidade da C√¢mera</label>
                        <div class="volume-control">
                            <input type="range" id="camera-sensitivity" min="0.1" max="2.0" step="0.1" value="1.0">
                            <span id="camera-sensitivity-value">1.0x</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="zoom-speed">Velocidade do Zoom</label>
                        <div class="volume-control">
                            <input type="range" id="zoom-speed" min="0.5" max="3.0" step="0.1" value="1.0">
                            <span id="zoom-speed-value">1.0x</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-footer">
                <button id="btn-reset-settings" class="settings-btn secondary">üîÑ Restaurar Padr√µes</button>
                <button id="btn-save-settings" class="settings-btn primary">üíæ Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de Controles -->
    <div id="controls-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üéÆ Controles do Jogo</h2>
                <button id="close-controls-modal" class="close-btn">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="controls-section">
                    <h3>üñ±Ô∏è Controles da C√¢mera</h3>
                    <ul>
                        <li><strong>Rotacionar:</strong> Clique e arraste com o mouse</li>
                        <li><strong>Zoom:</strong> Roda do mouse para aproximar/afastar</li>
                        <li><strong>Mover:</strong> Clique do meio + arrastar (ou Shift + clique)</li>
                    </ul>
                </div>

                <div class="controls-section">
                    <h3>üèóÔ∏è Constru√ß√£o</h3>
                    <ul>
                        <li><strong>Selecionar edif√≠cio:</strong> Clique na categoria e tipo desejado</li>
                        <li><strong>Visualizar posi√ß√£o:</strong> Mova o mouse sobre o terreno</li>
                        <li><strong>Construir:</strong> Clique esquerdo na posi√ß√£o desejada</li>
                        <li><strong>Cancelar:</strong> Pressione ESC ou clique fora da √°rea</li>
                    </ul>
                </div>

                <div class="controls-section">
                    <h3>‚è±Ô∏è Controles de Tempo</h3>
                    <ul>
                        <li><strong>Pausar/Continuar:</strong> Bot√£o ‚è∏Ô∏è</li>
                        <li><strong>Velocidade:</strong> Bot√µes 1x, 2x, 3x</li>
                        <li><strong>Rel√≥gio:</strong> Mostra data e hora do jogo</li>
                    </ul>
                </div>

                <div class="controls-section">
                    <h3>‚ÑπÔ∏è Informa√ß√µes</h3>
                    <ul>
                        <li><strong>Hover:</strong> Passe o mouse sobre edif√≠cios para ver detalhes</li>
                        <li><strong>Recursos:</strong> Monitore √°gua, popula√ß√£o, or√ßamento e polui√ß√£o</li>
                        <li><strong>Miss√µes:</strong> Acompanhe objetivos na parte inferior</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts do Jogo - Ordem correta de depend√™ncias -->

    <!-- Clean Code Refactoring: Game Constants (loaded first) -->
    <script src="js/config/GameConstants.js"></script>

    <!-- ===== TUTORIAL SYSTEM ===== -->
    <div id="tutorial-container">
        <div id="tutorial-background"></div>
        <div class="tutorial-content">
            

            <!-- Dialog Box -->
            <div class="tutorial-dialog-box">
              
                <div class="tutorial-dialog">
                  <!-- Character Portrait -->
            <div class="tutorial-portrait-container">
                <!-- 3D Model Canvas (for 3D characters) -->
                <canvas id="tutorial-portrait-canvas" style="display: none;"></canvas>
                <!-- 2D Image (fallback for non-3D characters) -->
                <img id="tutorial-portrait" src="" alt="Pesquisadora Claudia">
            </div>
                    <div class="tutorial-character-name" id="tutorial-character-name">Pesquisadora Claudia</div>

                    <div class="tutorial-dialog-header">
                        <span id="tutorial-icon">üëã</span>
                        <h2 id="tutorial-title">Bem-vindo!</h2>
                    </div>

                    <p id="tutorial-text">
                        Ol√°! Eu sou a Pesquisadora Claudia, e voc√™ foi escolhido para uma miss√£o muito importante!
                    </p>

                    <div class="tutorial-controls">
                        <div class="tutorial-progress" id="tutorial-progress">1 / 16</div>
                        <div class="tutorial-buttons">
                            <button id="tutorial-skip-btn" class="tutorial-btn">Pular Tutorial</button>
                            <button id="tutorial-prev-btn" class="tutorial-btn" disabled>Anterior</button>
                            <button id="tutorial-next-btn" class="tutorial-btn">Pr√≥ximo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== GAME OVER SYSTEM ===== -->
    <div id="gameover-container" style="display: none;">
        <div id="gameover-background"></div>
        <div class="tutorial-content">

            <!-- Dialog Box (reuse tutorial styling) -->
            <div class="tutorial-dialog-box">

                <div class="tutorial-dialog">
                    <!-- Character Portrait -->
                    <div class="tutorial-portrait-container">
                        <!-- 3D Model Canvas (for 3D characters) -->
                        <canvas id="gameover-portrait-canvas" style="display: none;"></canvas>
                        <!-- 2D Image (fallback for non-3D characters) -->
                        <img id="gameover-portrait" src="" alt="Pesquisadora Claudia">
                    </div>
                    <div class="tutorial-character-name" id="gameover-character-name">Pesquisadora Claudia</div>

                    <div class="tutorial-dialog-header">
                        <span id="gameover-icon">üíÄ</span>
                        <h2 id="gameover-title">Fim de Jogo</h2>
                    </div>

                    <div id="gameover-text" style="max-height: 400px; overflow-y: auto; padding-right: 10px;">
                        <p>O jogo terminou.</p>
                    </div>

                    <div class="tutorial-controls">
                        <div class="tutorial-buttons" style="justify-content: center;">
                            <button id="gameover-menu-btn" class="tutorial-btn" onclick="window.gameManager?.gameOverSystem?.returnToMainMenu()">
                                üè† Voltar ao Menu Principal
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Utilit√°rios primeiro -->
    <script src="js/utils/GameUtils.js"></script>
    <script src="js/utils/AssetLoader.js"></script>
    <script src="js/utils/AudioManager.js"></script>

    <!-- Core systems - ordem de depend√™ncia -->
    <script src="js/core/GridManager.js"></script>
    <script src="js/core/ResourceManager.js"></script>

    <!-- Camera Controls (before GameManager) -->
    <script src="js/systems/SimCityCameraControls.js"></script>

    <script src="js/core/GameManager.js"></script>

    <!-- Game systems -->
    <script src="js/systems/BuildingSystem.js"></script>
    <script src="js/systems/CityLifeSystem.js"></script>
    <script src="js/systems/UIManager.js"></script>
    <script src="js/systems/LoanManager.js"></script>
    <script src="js/systems/QuestSystem.js"></script>
    <script src="js/systems/EventSystem.js"></script>
    <script src="js/systems/SaveSystem.js"></script>
    <script src="js/systems/StudySystem.js"></script>
    <script src="js/systems/TutorialSystem.js"></script>
    <script src="js/systems/GameOverSystem.js"></script>
    <script src="js/systems/SettingsManager.js"></script>

    <!-- Main initialization -->
    <script src="js/main.js"></script>
</body>
</html>
